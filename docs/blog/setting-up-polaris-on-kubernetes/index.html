
<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">

    <head>

        
        <meta charset="UTF-8" />

        
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

                
        <title> 
             Setting Up Polaris on Kubernetes  
        </title>
        
        
            <link href="https://milindchawre.github.io/site/index.xml" rel="alternate" type="application/rss+xml" title="Milind&#39;s Blog" />
        

        
        <link rel="stylesheet" href="/site/css/style.css"/>

        
        
            <link rel='stylesheet' href='https://milindchawre.github.io/site/css/custom.css'>
        
        
    </head>

    <body>



<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://milindchawre.github.io/site/">
          <h1 id="nav-heading" class="title is-4">Milind&#39;s Blog</h1>
        </a>
      </div>
      <div class="nav-right">
        
        
        <nav id="nav-items" class="nav-item level is-mobile">
          <a class="level-item" aria-label="about" href='/site/about'
           rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="8"></line>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="resume" href='https://milindchawre.github.io'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.125 2.25H1.875A1.127 1.127 0 0 0 .75 3.375v17.25a1.127 1.127 0 0 0 1.125 1.125H6v-2.757c0-.351.192-.656.477-.817l.005-.002l4.311-2.396l-1.419-3.546V9.376a2.625 2.625 0 1 1 5.25 0v2.856l-1.419 3.546l4.312 2.396c.29.163.482.469.482.819v2.757h4.125a1.127 1.127 0 0 0 1.125-1.125V3.375a1.127 1.127 0 0 0-1.125-1.125zm-.375 18H19.5v-1.257c0-.911-.5-1.706-1.241-2.124l-.012-.006l-3.157-1.755l1.035-2.588V9.376a4.125 4.125 0 0 0-8.25 0v3.144l1.035 2.588l-3.157 1.755a2.441 2.441 0 0 0-1.253 2.13v1.257H2.25V3.75h19.5z" fill="black"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="email" href='mailto:milindchawre@outlook.com'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="github" href='https://github.com/milindchawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/milind-chawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="stackoverflow" href='https://stackoverflow.com/users/6790948/mchawre?tab=profile'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189l.451-2.07l-10.478-2.187l-.453 2.068zm1.359-5.056l9.705 4.53l.903-1.95l-9.706-4.53l-.902 1.936v.014zm2.715-4.785l8.217 6.855l1.359-1.62l-8.216-6.853l-1.35 1.617l-.01.001zM15.751 0l-1.746 1.294l6.405 8.604l1.746-1.294L15.749 0h.002z" fill="white"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="twitter" href='https://twitter.com/@milindchawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="facebook" href='https://facebook.com/milind.chawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="rss" href='/site/index.xml'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg>
</i>
            </span>
          </a></nav>
        
      
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
    
    <div class="container">
    
        
            
<div class="subtitle tags is-6 is-pulled-right">
    
        
<a class="subtitle is-6" href="/site/tags/kubernetes/">#kubernetes</a>



  
  | <a class="subtitle is-6" href="/site/tags/polaris/">#polaris</a>
  


    
</div>



<h2 class="subtitle is-6">
    
    
        April 27, 2020 | 18:01
    
</h2>



<h1 class="title">Setting Up Polaris on Kubernetes</h1>

<div class="content">

    
    <p><em>This blog was originally featured as a <a href="https://www.civo.com/learn/setting-up-polaris-on-k8s">guide</a> in civo cloud community.</em></p>
<p><a href="https://www.fairwinds.com/polaris">Polaris</a> is an open-source project that looks for configuration issues in kubernetes that can affect stability, reliability, scalability, and security. It was built by <a href="https://www.fairwinds.com/">Fairwinds (formerly ReactiveOps)</a>.</p>
<h4 id="problem">Problem</h4>
<p>Creating cluster is easy, but running it at scale with stability and security is hard. We have seen this often: a small mistake in deployment configuration can later result in bigger issues. Something like failing to configure resource requests can break auto scaling or even cause workloads to run out of resources. Polaris aims to catch and prevent such problems.</p>
<h4 id="polaris-features">Polaris Features</h4>
<ul>
<li>Dashboard for auditing Kubernetes workload configuration</li>
<li>Cli utility for auditing k8s yaml files</li>
<li>Polaris webhook that prevents future deployments if they don&rsquo;t meet the configured standard</li>
<li>Auditing more than just k8s resources like container health checks, image tags, networking, security settings, etc</li>
</ul>
<h4 id="installation">Installation</h4>
<p>The polaris dashboard can be <a href="https://github.com/FairwindsOps/polaris/blob/master/docs/usage.md#installing">installed</a> using <code>kubectl</code>, <code>helm</code> or <code>local binary</code>.</p>
<p>All methods will require you to have a cluster running, and the <code>KUBECONFIG</code> environment variable set up.</p>
<ul>
<li>kubectl</li>
</ul>
<pre><code>kubectl apply -f https://github.com/fairwindsops/polaris/releases/latest/download/dashboard.yaml
</code></pre><ul>
<li>helm</li>
</ul>
<pre><code>helm repo add fairwinds-stable https://charts.fairwinds.com/stable
helm upgrade --install polaris fairwinds-stable/polaris --namespace polaris
</code></pre><ul>
<li>binary : download the binary from <a href="https://github.com/fairwindsops/polaris/releases">release page</a></li>
</ul>
<p>then use port-forward to access the dashboard:</p>
<pre><code>kubectl port-forward --namespace polaris svc/polaris-dashboard 8080:80
</code></pre><p>and visit <code>http://localhost:8080/</code> to view the dashboard.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris1.png" alt="polaris1"></p>
<p>As shown in the dashboard, the polaris gives a <code>grade</code> and <code>score</code> to your kubernetes cluster based on the configuration of your workloads. You can now work to improve the workload configuration to improve your cluster <code>grade</code> and <code>score</code>. This will help in making your cluster more secure, stable, scalable, and resilient.</p>
<p>The standards out of the box are meant to be industry-leading, but can be adjusted in the dashboard to match your preferences and requirements.</p>
<p>The dashboard also provides a  high-level summary of checks for each category with some helpful information.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris2.png" alt="polaris2"></p>
<p>You can also see kubernetes deployments with specific misconfigurations listed.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris3.png" alt="polaris3"></p>
<p>As shown in the image above, this <a href="https://raw.githubusercontent.com/milindchawre/civo-k8s/master/blog/polaris/nginx.yaml">nginx-deployment</a> have few misconfigurations. For example, the image tag is not specified, resources like cpu and memory are missing, health checks are not configured and so on. Let&rsquo;s try to fix few of them.</p>
<p>Polaris also shows the meaning of each configuration and what config is missing with some reference links explaining the use and importance of each.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris4.png" alt="polaris4"></p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris5.png" alt="polaris5"></p>
<p>Now we can apply the new <a href="https://raw.githubusercontent.com/milindchawre/civo-k8s/master/blog/polaris/nginx-fix.yaml">nginx-deployment</a> where we have changed few things to fix few of the misconfigurations. The changes are summarised in the diff below:</p>
<pre><code>17c17
-         image: nginx:latest
---
+         image: nginx:1.18.0                        # Changed image tag from latest to specific release
19a20,50
+         resources:                                 # Added resource request and limits for cpu and memory
+           limits:
+             memory: &quot;200Mi&quot;
+             cpu: &quot;0.5&quot;
+           requests:
+             memory: &quot;100Mi&quot;
+             cpu: &quot;0.2&quot;
+         livenessProbe:                             # Added readiness and liveness probe
+           httpGet:
+             path: /
+             port: 80
+             httpHeaders:
+           initialDelaySeconds: 10
+           periodSeconds: 3
+           timeoutSeconds: 1
+           successThreshold: 1
+           failureThreshold: 3
+         readinessProbe:
+           httpGet:
+             path: /
+             port: 80
+           initialDelaySeconds: 10
+           periodSeconds: 3
+           timeoutSeconds: 1
+           successThreshold: 1
+           failureThreshold: 3
</code></pre><p>Now checking the nginx-deployment in polaris dashboard, a few of the mis-configurations should have gone.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/polaris/images/polaris6.png" alt="polaris6"></p>
<p>Fixing such mis-configuration for all workloads will improve the <code>grade</code> and <code>score</code> of your cluster that can be seen at the top of the polaris dashboard. This will make your cluster more secure, stable, scalable, and resilient.</p>
<h4 id="polaris-cli">Polaris Cli</h4>
<p>If you don&rsquo;t want to deploy polaris in your kubernetes cluster as an another application running along with other workloads, you can make use of <a href="https://github.com/FairwindsOps/polaris#cli">polaris cli</a>. With the CLI tool you can audit the k8s yaml and also view the polaris dashboard locally, or configure it to run as part of your CI/CD run, as detailed below.</p>
<h4 id="polaris-webhook">Polaris Webhook</h4>
<p>The <a href="https://github.com/FairwindsOps/polaris/blob/master/docs/usage.md#webhook">polaris webhook</a> provides a way to enforce some standards in all of your kubernetes deployments. Once you have addressed all the misconfigurations identified in the polaris dashboard, you can deploy the webhook to ensure that the configuration never slips below the configured standard. Once you deploy it in the cluster, the webhook will prevent any further kubernetes deployment that doesn&rsquo;t meet the configuration standard.</p>
<h4 id="polaris-in-cicd-pipelines">Polaris in CI/CD pipelines</h4>
<p>Polaris can be integrated in your CI/CD pipelines. You could set it to run on each deployment with something like the following added as a command in your pipeline, customised to your set requirements.</p>
<pre><code>polaris audit --audit-path path/to/my/deployment/yaml --set-exit-code-on-error --set-exit-code-below-score 90
</code></pre><p>For more information, check out the <a href="https://github.com/FairwindsOps/polaris">Polaris project on GitHub</a> and this intro <a href="https://www.youtube.com/watch?v=Vo4PBG6Vj0Q">video</a> for polaris.</p>


    
    
        <div class="related">

</div>
    

</div>


        

    </div>

</section>



<section class="section">
  <div class="container has-text-centered">
    <p>© 2020</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/pavel-pi/kiss-em">Kiss'Em</a>.</p>
    
  </div>
</section>

</body>
</html>

