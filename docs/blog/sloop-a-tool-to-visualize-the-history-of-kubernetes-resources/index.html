
<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">

    <head>

        
        <meta charset="UTF-8" />

        
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

                
        <title> 
             Sloop: a Tool to Visualize the History of Kubernetes Resources  
        </title>
        
        
            <link href="https://milindchawre.github.io/site/index.xml" rel="alternate" type="application/rss+xml" title="Milind&#39;s Blog" />
        

        
        <link rel="stylesheet" href="/site/css/style.css"/>

        
        
            <link rel='stylesheet' href='https://milindchawre.github.io/site/css/custom.css'>
        
        
    </head>

    <body>



<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="https://milindchawre.github.io/site/">
          <h1 id="nav-heading" class="title is-4">Milind&#39;s Blog</h1>
        </a>
      </div>
      <div class="nav-right">
        
        
        <nav id="nav-items" class="nav-item level is-mobile">
          <a class="level-item" aria-label="about" href='/site/about'
           rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="8"></line>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="resume" href='https://milindchawre.github.io'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M22.125 2.25H1.875A1.127 1.127 0 0 0 .75 3.375v17.25a1.127 1.127 0 0 0 1.125 1.125H6v-2.757c0-.351.192-.656.477-.817l.005-.002l4.311-2.396l-1.419-3.546V9.376a2.625 2.625 0 1 1 5.25 0v2.856l-1.419 3.546l4.312 2.396c.29.163.482.469.482.819v2.757h4.125a1.127 1.127 0 0 0 1.125-1.125V3.375a1.127 1.127 0 0 0-1.125-1.125zm-.375 18H19.5v-1.257c0-.911-.5-1.706-1.241-2.124l-.012-.006l-3.157-1.755l1.035-2.588V9.376a4.125 4.125 0 0 0-8.25 0v3.144l1.035 2.588l-3.157 1.755a2.441 2.441 0 0 0-1.253 2.13v1.257H2.25V3.75h19.5z" fill="black"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="email" href='mailto:milindchawre@outlook.com'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="github" href='https://github.com/milindchawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="linkedin" href='https://linkedin.com/in/milind-chawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path stroke-width="1.8" d="m5.839218,4.101561c0,1.211972 -0.974141,2.194011 -2.176459,2.194011s-2.176459,-0.982039 -2.176459,-2.194011c0,-1.211094 0.974141,-2.194011 2.176459,-2.194011s2.176459,0.982917 2.176459,2.194011zm0.017552,3.94922l-4.388022,0l0,14.04167l4.388022,0l0,-14.04167zm7.005038,0l-4.359939,0l0,14.04167l4.360816,0l0,-7.370999c0,-4.098413 5.291077,-4.433657 5.291077,0l0,7.370999l4.377491,0l0,-8.89101c0,-6.915523 -7.829986,-6.66365 -9.669445,-3.259423l0,-1.891237z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="stackoverflow" href='https://stackoverflow.com/users/6790948/mchawre?tab=profile'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189l.451-2.07l-10.478-2.187l-.453 2.068zm1.359-5.056l9.705 4.53l.903-1.95l-9.706-4.53l-.902 1.936v.014zm2.715-4.785l8.217 6.855l1.359-1.62l-8.216-6.853l-1.35 1.617l-.01.001zM15.751 0l-1.746 1.294l6.405 8.604l1.746-1.294L15.749 0h.002z" fill="white"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="twitter" href='https://twitter.com/@milindchawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="facebook" href='https://facebook.com/milind.chawre'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
    
  </svg>
</i>
            </span>
          </a>
          <a class="level-item" aria-label="rss" href='/site/index.xml'
           target='_blank'  rel='noopener'>
            <span class="icon">
              <i class>

<svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle>
    
  </svg>
</i>
            </span>
          </a></nav>
        
      
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
    
    <div class="container">
    
        
            
<div class="subtitle tags is-6 is-pulled-right">
    
        
<a class="subtitle is-6" href="/site/tags/kubernetes/">#kubernetes</a>



  
  | <a class="subtitle is-6" href="/site/tags/k3s/">#k3s</a>
  
  | <a class="subtitle is-6" href="/site/tags/sloop/">#sloop</a>
  


    
</div>



<h2 class="subtitle is-6">
    
    
        November 3, 2020 | 16:00
    
</h2>



<h1 class="title">Sloop: a Tool to Visualize the History of Kubernetes Resources</h1>

<div class="content">

    
    <p><em>This blog was originally featured as a <a href="https://www.civo.com/learn/sloop-a-tool-to-visualize-history-of-kubernetes-resources">guide</a> in civo cloud community.</em></p>
<h4 id="introducing-sloop">Introducing Sloop</h4>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/sloop/images/sloop-intro.png" alt="sloop-intro"></p>
<p><a href="https://github.com/salesforce/sloop">Sloop</a> is an open source tool to visualize history of all resources in your kubernetes cluster. It was built by <a href="https://www.salesforce.com">salesforce</a>.</p>
<h4 id="problem-keeping-track-of-events-in-your-clusters">Problem: Keeping track of events in your clusters</h4>
<p>Workloads running in Kubernetes cluster are dynamic in nature. The pods, replicas, deployments in your cluster keeps going on and off over the period of time due to their ephemeral nature. There are lot of situations when you want to check what happened in your cluster:</p>
<ul>
<li>to debug historic incidents</li>
<li>to debug common tasks like:
<ul>
<li>finding info and events related to kubernetes resources (like pods, replicasets, deployments, etc) that have been deleted like:
<ul>
<li>finding info related to pods/replicasets those are replaced by newer pods/replicasets after deployment update.</li>
<li>getting details of pods evicted from lost node.</li>
<li>getting info about lost kubernetes nodes, which no longer exists.</li>
<li>knowing rollout details of older deployments.</li>
<li>discover host where pods from previous deployment were running.</li>
<li>retrieving timings of pod replacements and their health checks.</li>
<li>long term behavioral analysis of your workloads running on your kubernetes cluster</li>
<li>and so on&hellip;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>basically, we may need information about all the events happening in a Kubernetes cluster.</p>
<h4 id="kubernetes-events">Kubernetes Events</h4>
<p><a href="https://kubernetes.io/docs/tasks/debug-application-cluster/events-stackdriver/">Kubernetes events</a> is the answer to tackle the above problem. Kubernetes events are great way to analyze past events in your cluster, since it captures all the events and resource state changes happening in your cluster. But there are few drawbacks:</p>
<ul>
<li>Kubernetes Events can generally only be accessed using only kubectl</li>
<li>The default retention period of kubernetes events is <a href="https://github.com/kubernetes/kubernetes/blob/a86afc12df023e8a45a1c3b6523aed38c3e6cd18/cmd/kube-apiserver/app/options/options.go#L108">1hr</a>.</li>
<li>The retention period can be increased using <code>--event-ttl</code> flag of kube-apiserver. But doing so <a href="https://github.com/kubernetes/kubernetes/issues/52521#issuecomment-329803408">can cause some serious problems</a> with cluster&rsquo;s key-value store.</li>
<li>There is no way to visualize these events.</li>
</ul>
<p>To address a few of the problems mentioned above, tools like <a href="https://github.com/bitnami-labs/kubewatch">Kubewatch</a>, <a href="https://github.com/heptiolabs/eventrouter">Eventrouter</a> and <a href="https://github.com/caicloud/event_exporter">Event-exporter</a> have been developed.</p>
<p><a href="https://github.com/bitnami-labs/kubewatch">Kubewatch</a> - Kubewatch is a tool to watch Kubernetes events and push notifications to available channels.</p>
<p><a href="https://github.com/heptiolabs/eventrouter">Eventrouter</a> - In eventrouter, the kubernetes events are captured and routed to a backend sink. A sink can be anything like an Amazon S3 bucket or an elasticsearch cluster where you can dump all your events, later you can create dashboards based on captured events using tools like <a href="https://www.elastic.co/kibana">Kibana</a> or <a href="https://grafana.com/">Grafana</a>. It supports multiple sinks.</p>
<p><a href="https://github.com/caicloud/event_exporter">Event-exporter</a> - A prometheus exporter to expose kubernetes events in prometheus format, which can then be stored in your prometheus server, and you can then either create alerts using <a href="https://prometheus.io/docs/alerting/latest/alertmanager/">Alertmanager</a> or create visualisation dashboard using <a href="https://grafana.com/">Grafana</a> based on these collected events.</p>
<p>The tools mentioned above are a good way to tackle most of the challenges posed by kubernetes events. But these are not a standalone solution, you have lot of work to do as an end user. You also need to configure other tools apart from these ones to store and visualize the events.</p>
<h4 id="sloop-your-ultimate-and-easy-solution">Sloop: Your Ultimate and Easy Solution</h4>
<p><a href="https://github.com/salesforce/sloop">Sloop</a> is a standalone solution which can store and visualize kubernetes events without needing as much effort from an end user perspective. Sloop monitors Kubernetes, recording histories of events and resource state changes, providing visualizations to aid in debugging past events.</p>
<h4 id="key-features">Key Features</h4>
<ul>
<li>Allows you to find and inspect resources that no longer exist in your kubernetes cluster</li>
<li>Helps in answering almost all the queries mentioned at the beginning of this blog</li>
<li>Provides a timeline displays that shows rollouts of related resources in updates to Deployments, ReplicaSets and StatefulSets</li>
<li>Helps in debugging transient and intermittent errors</li>
<li>Allows you to see changes over time in a Kubernetes application</li>
<li>Is a self-contained service with no dependencies on distributed storage</li>
</ul>
<h4 id="installation">Installation</h4>
<p><a href="https://github.com/salesforce/sloop">Sloop</a> can be installed using <code>helm</code> or as a standalone Docker container.</p>
<p>All methods will require you to have a kubernetes cluster running, and the <code>KUBECONFIG</code> environment variable set up. If you have not yet signed up to Civo, you can <a href="https://www.civo.com/?ref=80183a">sign up to apply</a> for our managed Kubernetes beta to try this out for yourself! During the beta, all users will get $70 worth of credit on their month-end statements, which is enough to run a three-node cluster 24/7 for the month.</p>
<ul>
<li>Helm</li>
</ul>
<pre><code>$ git clone https://github.com/salesforce/sloop
$ cd sloop/helm
$ kubectl create ns sloop
$ helm install sloop -n sloop ./sloop
</code></pre><ul>
<li>Docker container</li>
</ul>
<p>Refer to <a href="https://github.com/salesforce/sloop#local-docker-run">this document</a> to run sloop as a standalone docker container.</p>
<p>then use kubectl&rsquo;s port-forward function to access the dashboard:</p>
<pre><code>kubectl port-forward -n sloop service/sloop 8080:80
</code></pre><p>and visit <code>http://localhost:8080/</code> to view the dashboard.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/sloop/images/sloop1.png" alt="sloop1"></p>
<p>As you can see sloop provides timeline of your kubernetes resources. It also provides different filters to visualize it.</p>
<p>With Sloop, you can filter out kubernetes resources based on the time range, the kubernetes namespace, the kind of kubernetes resource (like pods, pvc, node, etc), the resource name and also sort events based on different options. Selecting a particular kubernetes resource in a specified timeline will show you different events occurring at that particular moment on that resource. This helps in capturing all past events that happened on that resources in your cluster.</p>
<p><img src="https://github.com/milindchawre/civo-k8s/raw/master/blog/sloop/images/sloop2.png" alt="sloop2"></p>
<p>Sloop also exposes a debug menu where you can see its configuration, internal metrics and different settings. You can also query its internal data store, there are lot of things to tweak around here.</p>
<h4 id="conclusion">Conclusion</h4>
<p>For more information, check out the <a href="https://github.com/salesforce/sloop">Sloop project on GitHub</a>.</p>
<p>If you found this guide useful, let us know on Twitter at <a href="https://twitter.com/milindchawre">@milindchawre</a>.</p>


    
    
        <div class="related">


<h3>Similar articles</h3>

<ul>
	
	<li><a href="/site/blog/k3s-upgrade-a-simplified-guide/">K3s Upgrade: A Simplified Guide</a></li>
	
	<li><a href="/site/blog/develop-and-test-your-code-directly-in-kubernetes-using-okteto/">Develop and Test Your Code Directly in Kubernetes Using Okteto</a></li>
	
	<li><a href="/site/blog/fairwinds-goldilocks-kubernetes-resource-recommendation-tool/">Fairwinds Goldilocks : Kubernetes Resource Recommendation Tool</a></li>
	
	<li><a href="/site/blog/setting-up-polaris-on-kubernetes/">Setting Up Polaris on Kubernetes</a></li>
	
</ul>


</div>
    

</div>


        

    </div>

</section>



<section class="section">
  <div class="container has-text-centered">
    <p>© 2020</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/pavel-pi/kiss-em">Kiss'Em</a>.</p>
    
  </div>
</section>

</body>
</html>

